<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Video Oynatıcı</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  .card {
    background: #1e293b;
    border-radius: 16px;
    padding: 2rem 1.5rem;
    max-width: 500px;
    width: 100%;
    text-align: center;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  .icon { font-size: 2.5rem; margin-bottom: 0.8rem; }
  h1 { font-size: 1.3rem; font-weight: 600; margin-bottom: 0.4rem; color: #f8fafc; }
  .time-badge {
    display: inline-block;
    background: #2563eb;
    color: white;
    padding: 0.35rem 0.9rem;
    border-radius: 8px;
    font-family: 'Consolas', 'Courier New', monospace;
    font-size: 1.2rem;
    font-weight: 700;
    margin: 0.8rem 0;
  }
  .info {
    font-size: 0.9rem;
    color: #94a3b8;
    margin: 0.5rem 0;
    line-height: 1.4;
  }
  .key-group { margin: 1rem 0; }
  .key-group label {
    display: block;
    font-size: 0.85rem;
    color: #cbd5e1;
    margin-bottom: 0.3rem;
    font-weight: 500;
  }
  .key-input {
    width: 100%;
    max-width: 220px;
    padding: 0.55rem 0.9rem;
    border: 2px solid #475569;
    border-radius: 8px;
    background: #0f172a;
    color: #f1f5f9;
    font-size: 1.05rem;
    text-align: center;
    font-weight: 600;
    letter-spacing: 0.05em;
    outline: none;
    transition: border-color 0.2s;
  }
  .key-input:focus { border-color: #3b82f6; }
  .key-input::placeholder { color: #64748b; font-weight: 400; }
  .btn {
    display: inline-block;
    margin-top: 0.8rem;
    padding: 0.8rem 1.8rem;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1.05rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
  }
  .btn:hover { background: #1d4ed8; transform: scale(1.02); }
  .btn:active { transform: scale(0.98); }
  .error { color: #f87171; font-size: 0.85rem; margin-top: 0.4rem; }
  .help {
    margin-top: 1.2rem;
    padding-top: 0.8rem;
    border-top: 1px solid #334155;
    font-size: 0.78rem;
    color: #64748b;
    line-height: 1.5;
  }
  .saved-note {
    font-size: 0.78rem;
    color: #22c55e;
    margin-top: 0.3rem;
  }
  .hidden { display: none; }

  /* SAFARI UYARI BANNER */
  .safari-warn {
    background: linear-gradient(135deg, #92400e 0%, #b45309 100%);
    border: 1px solid #f59e0b;
    border-radius: 12px;
    padding: 1rem 1.2rem;
    margin-bottom: 1rem;
    max-width: 500px;
    width: 100%;
    text-align: left;
    box-shadow: 0 4px 16px rgba(245,158,11,0.2);
  }
  .safari-warn-title {
    font-size: 0.95rem;
    font-weight: 700;
    color: #fef3c7;
    margin-bottom: 0.5rem;
  }
  .safari-warn-text {
    font-size: 0.82rem;
    color: #fde68a;
    line-height: 1.55;
    margin-bottom: 0.6rem;
  }
  .safari-warn-steps {
    font-size: 0.8rem;
    color: #fef9c3;
    line-height: 1.7;
    padding-left: 0.2rem;
  }
  .safari-warn-steps b {
    color: #fff;
  }
  .safari-warn-dismiss {
    display: inline-block;
    margin-top: 0.6rem;
    padding: 0.3rem 0.8rem;
    background: rgba(255,255,255,0.15);
    color: #fef3c7;
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 6px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  .safari-warn-dismiss:hover { background: rgba(255,255,255,0.25); }

  /* VIDEO PLAYER */
  .player-wrap {
    width: 100%;
    max-width: 960px;
    margin: 0 auto;
    padding: 0 0.5rem;
  }
  .player-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.8rem 0;
  }
  .player-header h2 {
    font-size: 1.1rem;
    color: #f8fafc;
    font-weight: 600;
  }
  .player-time {
    background: #2563eb;
    color: white;
    padding: 0.25rem 0.7rem;
    border-radius: 6px;
    font-family: 'Consolas', monospace;
    font-size: 0.95rem;
    font-weight: 700;
  }
  .video-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 24px rgba(0,0,0,0.5);
  }
  .video-container iframe {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
  .player-footer {
    padding: 0.6rem 0;
    text-align: center;
  }
  .fullscreen-btn {
    display: inline-block;
    margin-top: 0.5rem;
    padding: 0.5rem 1.2rem;
    background: #334155;
    color: #e2e8f0;
    border: none;
    border-radius: 8px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  .fullscreen-btn:hover { background: #475569; }
  .player-note {
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.4rem;
  }
</style>
</head>
<body>

<!-- SAFARI UYARI BANNER -->
<div class="safari-warn hidden" id="safariWarn">
  <div class="safari-warn-title">⚠️ Safari Kullanıcıları İçin Önemli</div>
  <div class="safari-warn-text">
    Safari'nin gizlilik ayarları Google Drive videolarının oynatılmasını engelleyebilir. Video yüklenmezse aşağıdaki adımları uygulayın:
  </div>
  <div class="safari-warn-steps" id="safariSteps"></div>
  <button class="safari-warn-dismiss" id="safariDismiss">Anladım, kapat</button>
</div>

<!-- ANAHTAR EKRANI -->
<div class="card" id="keyScreen">
  <div class="icon">&#x1F3AC;</div>
  <h1>Video Oynatıcı</h1>

  <div id="errorBox" class="hidden">
    <div class="info error" id="errorMsg"></div>
  </div>

  <div id="mainArea" class="hidden">
    <div class="time-badge" id="timeBadge"></div>
    <div class="info" id="infoText"></div>

    <div class="key-group">
      <label for="keyInput">Anahtar kelimeyi girin:</label>
      <input type="text" id="keyInput" class="key-input" placeholder="anahtar" autocomplete="off" autocapitalize="none" spellcheck="false">
      <div id="savedNote" class="saved-note hidden"></div>
    </div>
    <div id="keyError" class="error hidden"></div>

    <button class="btn" id="goBtn">&#x25B6;&#xFE0F; Videoyu Aç</button>
  </div>

  <div class="help">
    Anahtar kelimeyi girip butona basın.<br>
    Anahtar bu cihazda hatırlanır. Değiştirmek isterseniz silip yenisini yazın.
  </div>
</div>

<!-- VIDEO PLAYER EKRANI -->
<div class="player-wrap hidden" id="playerScreen">
  <div class="player-header">
    <h2>&#x1F3AC; Video Oynatıcı</h2>
    <span class="player-time" id="playerTime"></span>
  </div>
  <div class="video-container" id="videoContainer">
  </div>
  <div class="player-footer">
    <button class="fullscreen-btn" id="fsBtn">&#x1F4FA; Tam Ekran</button>
    <div class="player-note">Tam ekran için yukarıdaki butona veya video içindeki butona basın.</div>
  </div>
</div>

<script>
(function() {

  /* === SAFARI / iOS TESPİT & UYARI === */
  var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

  if (isSafari || isIOS) {
    var warn = document.getElementById('safariWarn');
    var steps = document.getElementById('safariSteps');

    if (isIOS) {
      steps.innerHTML =
        '<b>iPhone / iPad:</b><br>' +
        '1\uFE0F\u20E3 Ayarlar uygulamasını açın<br>' +
        '2\uFE0F\u20E3 Aşağı kaydırıp <b>Safari</b> (veya <b>Uygulamalar → Safari</b>) seçin<br>' +
        '3\uFE0F\u20E3 Gizlilik ve Güvenlik bölümünde<br>' +
        '\u00A0\u00A0\u00A0\u00A0<b>"Siteler Arası İzlemeyi Engelle"</b> seçeneğini <b>kapatın</b><br>' +
        '4\uFE0F\u20E3 Bu sayfaya dönüp yenileyin<br>' +
        '<br><span style="font-size:0.75rem;color:#fcd34d;">Not: Video izledikten sonra ayarı tekrar açabilirsiniz.</span>';
    } else {
      steps.innerHTML =
        '<b>Mac Safari:</b><br>' +
        '1\uFE0F\u20E3 Safari → Tercihler (veya Ayarlar) → Gizlilik<br>' +
        '2\uFE0F\u20E3 <b>"Siteler arası izlemeyi engelle"</b> seçeneğinin işaretini kaldırın<br>' +
        '3\uFE0F\u20E3 Sayfayı yenileyin<br>' +
        '<br><span style="font-size:0.75rem;color:#fcd34d;">Not: Video izledikten sonra ayarı tekrar açabilirsiniz.</span>';
    }

    warn.classList.remove('hidden');

    document.getElementById('safariDismiss').addEventListener('click', function() {
      warn.classList.add('hidden');
    });
  }

  /* === MEVCUT KOD (AYNEN) === */
  var STORAGE_KEY = 'vp_key';
  var p = new URLSearchParams(window.location.search);
  var _d = p.get('d');
  var _t = p.get('t');

  function showError(m) {
    document.getElementById('errorBox').classList.remove('hidden');
    document.getElementById('errorMsg').textContent = m;
  }
  function showKeyError(m) {
    var el = document.getElementById('keyError');
    el.textContent = m;
    el.classList.remove('hidden');
  }

  if (!_d) {
    showError('Video parametresi (d) eksik.');
    return;
  }

  if (_t) _t = _t.replace(/[^0-9hms]/g, '');

  document.getElementById('mainArea').classList.remove('hidden');
  if (_t && _t !== '0s') {
    document.getElementById('timeBadge').textContent = '\u23F1 ' + fmtTime(_t);
    document.getElementById('infoText').textContent = 'Video ' + fmtTime(_t) + ' zaman\u0131nda ba\u015Flayacak.';
  } else {
    document.getElementById('timeBadge').textContent = '\u25B6\uFE0F Ba\u015Ftan';
    document.getElementById('infoText').textContent = 'Video ba\u015Ftan oynat\u0131lacak.';
  }

  /* KAYITLI ANAHTARI YUKLE */
  var keyInput = document.getElementById('keyInput');
  var savedNote = document.getElementById('savedNote');
  try {
    var saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      keyInput.value = saved;
      savedNote.textContent = '\u2705 Kay\u0131tl\u0131 anahtar y\u00FCklendi. De\u011Fi\u015Ftirmek i\u00E7in silin.';
      savedNote.classList.remove('hidden');
    }
  } catch(e) {}

  /* Enter tusu */
  keyInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') document.getElementById('goBtn').click();
  });

  /* BUTONA BASINCA */
  document.getElementById('goBtn').addEventListener('click', function() {
    document.getElementById('keyError').classList.add('hidden');

    var raw = keyInput.value;
    if (!raw || !raw.trim()) {
      showKeyError('L\u00FCtfen anahtar kelimeyi girin.');
      return;
    }

    var key = raw.trim().toLowerCase();

    var h = _d.replace(/[^0-9a-fA-F]/g, '');
    if (h.length < 20 || h.length % 2 !== 0) {
      showKeyError('Ge\u00E7ersiz video kodu.');
      return;
    }

    /* XOR decode */
    var id = '';
    for (var i = 0; i < h.length; i += 2) {
      var byte = parseInt(h.substr(i, 2), 16);
      var kc = key.charCodeAt((i / 2) % key.length);
      id += String.fromCharCode(byte ^ kc);
    }

    id = id.replace(/[^a-zA-Z0-9_\-]/g, '');
    if (id.length < 10) {
      showKeyError('Hatal\u0131 anahtar. Tekrar deneyin.');
      return;
    }

    /* ANAHTARI KAYDET */
    try {
      localStorage.setItem(STORAGE_KEY, raw.trim());
    } catch(e) {}

    /* URL olustur */
    var s1 = [104,116,116,112,115,58,47,47];
    var s2 = [100,114,105,118,101,46,103,111,111,103,108,101,46,99,111,109];
    var s3 = [47,102,105,108,101,47,100,47];
    var s4 = [47,112,114,101,118,105,101,119];

    var url = '';
    for (var j = 0; j < s1.length; j++) url += String.fromCharCode(s1[j]);
    for (var j = 0; j < s2.length; j++) url += String.fromCharCode(s2[j]);
    for (var j = 0; j < s3.length; j++) url += String.fromCharCode(s3[j]);
    url += id;
    for (var j = 0; j < s4.length; j++) url += String.fromCharCode(s4[j]);

    if (_t && _t !== '0s') {
      url += '?t=' + _t;
    }

    document.getElementById('keyScreen').classList.add('hidden');
    document.getElementById('playerScreen').classList.remove('hidden');

    /* Safari uyarisini player ekraninda da goster */
    if (isSafari || isIOS) {
      var warn = document.getElementById('safariWarn');
      if (!warn.classList.contains('hidden')) {
        var playerWrap = document.getElementById('playerScreen');
        playerWrap.insertBefore(warn, playerWrap.firstChild);
      }
    }

    if (_t && _t !== '0s') {
      document.getElementById('playerTime').textContent = '\u23F1 ' + fmtTime(_t);
    } else {
      document.getElementById('playerTime').textContent = '\u25B6\uFE0F Ba\u015Ftan';
    }

    var iframe = document.createElement('iframe');
    iframe.src = url;
    iframe.setAttribute('allowfullscreen', 'true');
    iframe.setAttribute('allow', 'autoplay; fullscreen');
    iframe.id = 'videoFrame';
    document.getElementById('videoContainer').appendChild(iframe);

    document.getElementById('fsBtn').addEventListener('click', function() {
      var vc = document.getElementById('videoContainer');
      if (vc.requestFullscreen) vc.requestFullscreen();
      else if (vc.webkitRequestFullscreen) vc.webkitRequestFullscreen();
      else if (vc.mozRequestFullScreen) vc.mozRequestFullScreen();
      else if (vc.msRequestFullscreen) vc.msRequestFullscreen();
    });
  });

  function fmtTime(t) {
    var h = 0, m = 0, s = 0;
    var a = t.match(/(\d+)h/), b = t.match(/(\d+)m/), c = t.match(/(\d+)s/);
    if (a) h = parseInt(a[1]); if (b) m = parseInt(b[1]); if (c) s = parseInt(c[1]);
    return pad(h) + ':' + pad(m) + ':' + pad(s);
  }
  function pad(n) { return n < 10 ? '0' + n : '' + n; }
})();
</script>
</body>
</html>